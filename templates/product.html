<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ product.name }} | LR Fragrances</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />

    <!-- Animations CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/animations.css') }}"
    />

    <!-- Main.js -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <header class="navbar">
      <div class="logo">
        <img
          src="{{ url_for('static', filename='images/products/monogram.jpeg') }}"
          class="logo-img"
        />
        <h1>LR Fragrances</h1>
      </div>

      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>

      <nav id="nav-menu">
        <a href="/">Home</a>
        <a href="/admin">Admin</a>
        <a href="/shop">Shop</a>
        <a href="/contact">Contact</a>
        <a href="/about">About</a>
        <a href="/cart"
          ><i class="fa-solid fa-cart-shopping"></i> ({{ cart_count }})</a
        >
      </nav>
    </header>

    <div class="nav-overlay" id="navOverlay"></div>

    <!-- ================= PRODUCT DETAILS ================= -->
    <section class="product-details animate-fade-in-up">
      <!-- Image -->
      <div class="product-image animate-image-zoom">
        <img
          src="{{ url_for('static', filename='images/products/' + product.image) }}"
          alt="{{ product.name }}"
        />
      </div>

      <!-- Info -->
      <div class="product-info animate-slide-in-right">
        <h2 class="animate-fade-in">{{ product.name }}</h2>
        <p class="size animate-fade-in-up">Size: {{ product.size }}</p>

        {% if product.discount > 0 %}
        <p class="price">
          <span class="old-price">Rs {{ product.price }}</span>
          <span class="new-price animate-price-badge">
            Rs {{ product.price - (product.price * product.discount // 100) }}
          </span>
        </p>
        <span class="discount-badge animate-badge"
          >{{ product.discount }}% OFF</span
        >
        {% else %}
        <p class="price">Rs {{ product.price }}</p>
        {% endif %}

        <!-- âœ… REAL DESCRIPTION -->
        <div class="product-description animate-fade-in-up">
          <h3>Description</h3>
          {% if product.description %}
          <p>{{ product.description }}</p>
          {% else %}
          <p class="muted">No description available.</p>
          {% endif %}
        </div>

        <div class="details-actions">
          <a
            href="/add-to-cart/{{ product.id }}"
            class="btn-secondary animate-btn"
            >Add to Cart</a
          >
          <a href="/shop" class="btn-secondary animate-btn">Back to Shop</a>
        </div>
      </div>
    </section>

    <!-- ================= CUSTOMER REVIEWS SECTION ================= -->
    <div class="customer-reviews-section animate-section-delay">
        <h2 class="section-title animate-fade-in">Customer Reviews</h2>

        <!-- ================= REVIEW SUMMARY ================= -->
        <div class="review-summary-container animate-fade-in-up">
          <div class="rating-overview">
            <div class="avg-rating-display">
              <span class="large-rating animate-scale-in"
                >{{ avg_rating if avg_rating else "0.0" }}</span
              >
              <div class="stars-display animate-stars">
                {% for i in range(1, 6) %}
                <i
                  class="fa-{% if i <= (avg_rating|round(0,'floor') if avg_rating else 0) %}solid{% else %}regular{% endif %} fa-star"
                ></i>
                {% endfor %}
              </div>
              <p class="review-count">
                <span class="bold-count">{{ reviews|length }}</span> verified
                reviews
              </p>
            </div>

            <!-- ================= RATING DISTRIBUTION ================= -->
            <div class="rating-distribution">
              {% for star in range(5, 0, -1) %} {% set count =
              reviews|selectattr('rating', 'equalto', star)|list|length %}
              <div class="rating-bar animate-slide-in-left">
                <span class="star-label"
                  >{{ star }} <i class="fas fa-star"></i
                ></span>
                <div class="bar-container">
                  <div
                    class="bar-fill"
                    data-width="{% if reviews|length > 0 %}{{ (count / (reviews|length)) * 100 }}{% else %}0{% endif %}"
                  ></div>
                </div>
                <span class="star-count">{{ count }}</span>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        {% if reviews|length > 0 %}
        <!-- ================= REVIEW LIST ================= -->
        <div class="reviews-list-container animate-fade-in-up">
          <div class="reviews-header">
            <h3>Reviews from customers</h3>
            <div class="sort-options">
              <label for="sort-reviews">Sort by:</label>
              <select id="sort-reviews" onchange="sortReviews(this.value)">
                <option value="recent">Most Recent</option>
                <option value="highest">Highest Rating</option>
                <option value="lowest">Lowest Rating</option>
              </select>
            </div>
          </div>

          <div class="reviews-grid" id="reviewsGrid">
            {% for review in reviews %}
            <div
              class="review-item animate-review"
              data-rating="{{ review.rating }}"
            >
              <div class="review-top">
                <div class="reviewer-info">
                  <h4 class="reviewer-name">
                    {{ review.username if review.username else "Verified Buyer"
                    }}
                  </h4>
                  <span class="verified-badge animate-fade-in">
                    <i class="fas fa-check-circle"></i> Verified Purchase
                  </span>
                </div>
                <div class="review-date">
                  {% if review.created_at %}
                  <time>{{ review.created_at[:10] }}</time>
                  {% endif %}
                </div>
              </div>

              <div class="review-rating animate-stars">
                {% for i in range(1, 6) %}
                <i
                  class="fa-{% if i <= review.rating %}solid{% else %}regular{% endif %} fa-star"
                ></i>
                {% endfor %}
              </div>

              <p class="review-text">{{ review.comment }}</p>

              <div class="review-footer">
                <button
                  class="helpful-btn animate-btn"
                  onclick="markHelpful(this)"
                >
                  <i class="fas fa-thumbs-up"></i> Helpful
                </button>
                <button
                  class="helpful-btn animate-btn"
                  onclick="markUnhelpful(this)"
                >
                  <i class="fas fa-thumbs-down"></i> Not Helpful
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% else %}
        <div class="no-reviews-message animate-fade-in">
          <i class="fas fa-comment-dots"></i>
          <p>No reviews yet. Be the first to share your experience!</p>
        </div>
        {% endif %}

        <!-- ================= REVIEW SUBMISSION FORM ================= -->
        <div class="review-submission">
          <h3>Share Your Experience</h3>
          <p class="form-subtitle">
            Your review helps other customers discover great products
          </p>

          <form
            method="POST"
            action="/product/{{ product.id }}/review"
            class="review-form"
          >
            <div class="form-group">
              <label for="reviewer-name">Your Name</label>
              <input
                type="text"
                id="reviewer-name"
                name="name"
                placeholder="Enter your name (optional)"
                maxlength="100"
              />
            </div>

            <div class="form-group">
              <label for="rating-select"
                >Rating <span class="required">*</span></label
              >
              <div class="rating-selector">
                <input
                  type="hidden"
                  id="rating-select"
                  name="rating"
                  value=""
                />
                <div class="star-selector">
                  {% for i in range(1, 6) %}
                  <label class="star-label-input" data-value="{{ 6 - i }}">
                    <input
                      type="radio"
                      name="rating"
                      value="{{ 6 - i }}"
                      style="display: none"
                    />
                    <i class="far fa-star"></i>
                  </label>
                  {% endfor %}
                </div>
                <span id="rating-text" class="rating-text"
                  >Select a rating</span
                >
              </div>
            </div>

            <div class="form-group">
              <label for="review-text"
                >Your Review <span class="required">*</span></label
              >
              <textarea
                id="review-text"
                name="review"
                rows="5"
                placeholder="Share your experience with this product..."
                maxlength="1000"
                required
              ></textarea>
              <span class="char-count"><span id="char-used">0</span>/1000</span>
            </div>

            <button type="submit" class="submit-btn">
              <span>Submit Review</span>
              <i class="fas fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ================= RELATED PRODUCTS ================= -->
    <section class="related-products">
      <h3>You May Also Like</h3>

      <div class="products">
        {% for item in related %}
        <div class="product-card">
          <img
            src="{{ url_for('static', filename='images/products/' + item.image) }}"
            alt="{{ item.name }}"
          />

          <div class="product-info">
            <h4>{{ item.name }}</h4>
            <p class="size">{{ item.size }}</p>

            {% if item.discount > 0 %}
            <p class="price">
              <span class="old-price">Rs {{ item.price }}</span>
              <span class="new-price">
                Rs {{ item.price - (item.price * item.discount // 100) }}
              </span>
            </p>
            {% else %}
            <p class="price">Rs {{ item.price }}</p>
            {% endif %}

            <a href="/product/{{ item.id }}" class="btn-secondary">View</a>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
    <style>
      /* ================= PRODUCT DETAILS - CLEAN RESPONSIVE ================= */
      .product-details {
        max-width: 1200px;
        margin: 40px auto;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
      }

      /* Product image */
      .product-image {
        width: 100%;
      }

      .product-image img {
        width: 100%;
        height: auto;
        max-height: 480px;
        object-fit: cover;
        border-radius: 12px;
        display: block;
      }

      /* Product info */
      .product-info {
        width: 100%;
      }

      .product-info h2 {
        font-size: 24px;
        margin: 0 0 12px 0;
        color: var(--secondary-color);
      }

      .product-info .size {
        color: var(--light-text);
        font-size: 14px;
        margin-bottom: 12px;
      }

      .product-info .price {
        font-size: 18px;
        margin: 12px 0;
      }

      .product-info .old-price {
        text-decoration: line-through;
        color: #888;
        margin-right: 8px;
      }

      .product-info .new-price {
        color: #ff6b6b;
        font-weight: 700;
      }

      .discount-badge {
        display: inline-block;
        background: #d4af37;
        color: #000;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 12px;
        margin-bottom: 12px;
      }

      .product-description {
        margin: 16px 0;
      }

      .product-description h3 {
        color: #d4af37;
        margin-bottom: 8px;
        font-size: 16px;
      }

      .product-description p {
        color: var(--light-text);
        font-size: 14px;
        line-height: 1.6;
      }

      /* Action buttons */
      .details-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 16px;
      }

      .details-actions a {
        padding: 12px 18px;
        font-size: 14px;
        border-radius: 10px;
        text-align: center;
        flex: 1 1 auto;
        min-width: 140px;
      }

      /* Desktop: side-by-side layout */
      @media (min-width: 900px) {
        .product-details {
          grid-template-columns: 1fr 1.2fr;
          gap: 40px;
          padding: 40px;
        }

        .product-image img {
          max-height: 600px;
        }

        .product-info h2 {
          font-size: 32px;
        }

        .product-info .price {
          font-size: 22px;
        }

        .details-actions a {
          padding: 14px 24px;
          font-size: 15px;
        }
      }

      /* Tablet */
      @media (min-width: 600px) and (max-width: 899px) {
        .product-details {
          grid-template-columns: 1fr;
          padding: 24px;
        }

        .product-image img {
          max-height: 500px;
        }

        .product-info h2 {
          font-size: 28px;
        }

        .details-actions a {
          flex: 1 1 48%;
        }
      }

      /* Mobile */
      @media (max-width: 599px) {
        .product-details {
          padding: 12px;
          gap: 18px;
        }

        .product-image img {
          max-height: 360px;
        }

        .product-info h2 {
          font-size: 20px;
        }

        .product-info .price {
          font-size: 16px;
        }

        .details-actions a {
          padding: 10px 14px;
          font-size: 13px;
          flex: 1 1 48%;
        }
      }

      /* ================= RELATED PRODUCTS ================= */
      .related-products {
        max-width: 1200px;
        margin: 60px auto;
        padding: 0 20px;
      }

      .related-products h3 {
        font-size: 28px;
        color: var(--secondary-color);
        margin-bottom: 30px;
        text-align: center;
      }

      .related-products .products {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
      }

      @media (min-width: 600px) {
        .related-products .products {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (min-width: 900px) {
        .related-products .products {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      /* ================= CUSTOMER REVIEWS SECTION ================= */
      .customer-reviews-section {
        margin-top: 80px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        padding: 0 30px;
      }

      .section-title {
        font-family: "Playfair Display", serif;
        font-size: 36px;
        color: #d4af37;
        margin-bottom: 50px;
        text-align: center;
        font-weight: 700;
        letter-spacing: 1px;
      }

      /* ================= REVIEW SUMMARY ================= */
      .review-summary-container {
        background: linear-gradient(
          135deg,
          rgba(212, 175, 55, 0.1),
          rgba(212, 175, 55, 0.05)
        );
        border: 1px solid rgba(212, 175, 55, 0.3);
        border-radius: 20px;
        padding: 50px;
        margin-bottom: 60px;
      }

      .rating-overview {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 60px;
        align-items: center;
      }

      .avg-rating-display {
        text-align: center;
      }

      .large-rating {
        font-size: 72px;
        font-weight: 700;
        color: #d4af37;
        display: block;
        line-height: 1;
      }

      .stars-display {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 15px 0;
        font-size: 24px;
      }

      .stars-display i {
        color: #d4af37;
      }

      .review-count {
        color: #ccc;
        font-size: 16px;
        margin: 0;
      }

      .bold-count {
        font-weight: 700;
        color: #fff;
        font-size: 18px;
      }

      /* ================= RATING DISTRIBUTION ================= */
      .rating-distribution {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .rating-bar {
        display: grid;
        grid-template-columns: 80px 1fr 50px;
        gap: 15px;
        align-items: center;
      }

      .star-label {
        font-weight: 600;
        color: #fff;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .star-label i {
        color: #d4af37;
        font-size: 14px;
      }

      .bar-container {
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
      }

      .bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #d4af37, #b8962e);
        border-radius: 10px;
        transition: width 0.4s ease;
        width: 0%;
      }

      .star-count {
        text-align: right;
        color: #999;
        font-size: 14px;
        min-width: 30px;
      }

      /* ================= REVIEWS LIST CONTAINER ================= */
      .reviews-list-container {
        margin-bottom: 70px;
      }

      .reviews-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        flex-wrap: wrap;
        gap: 20px;
      }

      .reviews-header h3 {
        font-family: "Playfair Display", serif;
        font-size: 26px;
        color: #fff;
        margin: 0;
      }

      .sort-options {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .sort-options label {
        color: #ccc;
        font-size: 14px;
        font-weight: 500;
      }

      .sort-options select {
        padding: 10px 15px;
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid rgba(212, 175, 55, 0.4);
        color: #fff;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .sort-options select:hover,
      .sort-options select:focus {
        border-color: #d4af37;
        box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.15);
      }

      /* ================= REVIEWS GRID ================= */
      .reviews-grid {
        display: grid;
        gap: 24px;
      }

      .review-item {
        padding: 30px;
        background: rgba(20, 20, 20, 0.8);
        border: 1px solid rgba(212, 175, 55, 0.2);
        border-radius: 16px;
        transition: all 0.35s cubic-bezier(0.23, 1, 0.32, 1);
      }

      .review-item:hover {
        border-color: rgba(212, 175, 55, 0.5);
        box-shadow: 0 20px 50px rgba(212, 175, 55, 0.15);
        transform: translateY(-6px);
      }

      .review-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 18px;
        gap: 15px;
      }

      .reviewer-info h4 {
        margin: 0 0 8px 0;
        color: #fff;
        font-size: 16px;
        font-weight: 600;
      }

      .verified-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: #4caf50;
        background: rgba(76, 175, 80, 0.15);
        padding: 5px 12px;
        border-radius: 20px;
      }

      .verified-badge i {
        font-size: 12px;
      }

      .review-date time {
        color: #888;
        font-size: 13px;
        font-weight: 500;
      }

      .review-rating {
        display: flex;
        gap: 6px;
        margin-bottom: 16px;
        font-size: 16px;
      }

      .review-rating i {
        color: #d4af37;
      }

      .review-text {
        color: #ccc;
        font-size: 15px;
        line-height: 1.8;
        margin: 0 0 20px 0;
      }

      .review-footer {
        display: flex;
        gap: 12px;
        padding-top: 16px;
        border-top: 1px solid rgba(212, 175, 55, 0.15);
      }

      .helpful-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        background: transparent;
        border: 1px solid rgba(212, 175, 55, 0.3);
        color: #ccc;
        border-radius: 8px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .helpful-btn:hover {
        border-color: #d4af37;
        color: #d4af37;
        background: rgba(212, 175, 55, 0.1);
      }

      .helpful-btn i {
        font-size: 12px;
      }

      /* ================= NO REVIEWS MESSAGE ================= */
      .no-reviews-message {
        text-align: center;
        padding: 60px 30px;
        color: #888;
      }

      .no-reviews-message i {
        font-size: 48px;
        color: #666;
        margin-bottom: 20px;
        display: block;
      }

      .no-reviews-message p {
        font-size: 16px;
        margin: 0;
      }

      /* ================= REVIEW SUBMISSION FORM ================= */
      .review-submission {
        background: linear-gradient(
          135deg,
          rgba(212, 175, 55, 0.08),
          rgba(212, 175, 55, 0.03)
        );
        border: 1px solid rgba(212, 175, 55, 0.25);
        border-radius: 18px;
        padding: 50px;
        margin-top: 70px;
      }

      .review-submission h3 {
        font-family: "Playfair Display", serif;
        font-size: 28px;
        color: #d4af37;
        margin: 0 0 12px 0;
        font-weight: 700;
      }

      .form-subtitle {
        color: #999;
        font-size: 15px;
        margin: 0 0 40px 0;
        font-style: italic;
      }

      .review-form {
        display: grid;
        gap: 30px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .form-group label {
        color: #fff;
        font-weight: 600;
        font-size: 15px;
        letter-spacing: 0.3px;
      }

      .required {
        color: #ff6b6b;
      }

      .review-form input,
      .review-form textarea {
        padding: 14px 18px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(212, 175, 55, 0.3);
        border-radius: 10px;
        color: #fff;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.3s ease;
      }

      .review-form input::placeholder,
      .review-form textarea::placeholder {
        color: #898585;
      }

      .review-form input:focus,
      .review-form textarea:focus {
        outline: none;
        border-color: #d4af37;
        box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        background: rgba(0, 0, 0, 0.5);
      }

      /* ================= RATING SELECTOR ================= */
      .rating-selector {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .star-selector {
        display: flex;
        gap: 12px;
        flex-direction: row-reverse;
      }

      .star-label-input {
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .star-label-input i {
        font-size: 28px;
        color: #555;
        transition: color 0.2s ease;
      }

      .star-label-input input:checked ~ i,
      .star-label-input:hover i {
        color: #d4af37;
      }

      .rating-text {
        color: #999;
        font-size: 14px;
        min-width: 150px;
      }

      /* ================= CHARACTER COUNT ================= */
      .char-count {
        font-size: 12px;
        color: #777;
        text-align: right;
      }

      /* ================= SUBMIT BUTTON ================= */
      .submit-btn {
        align-self: flex-start;
        padding: 14px 40px;
        background: linear-gradient(135deg, #d4af37 0%, #b8962e 100%);
        color: #000;
        border: none;
        border-radius: 30px;
        font-weight: 700;
        font-size: 15px;
        letter-spacing: 0.8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
      }

      .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(212, 175, 55, 0.5);
      }

      .submit-btn i {
        font-size: 14px;
      }

      /* ================= RESPONSIVE DESIGN ================= */
      @media (max-width: 1024px) {
        .rating-overview {
          grid-template-columns: 1fr;
          gap: 40px;
        }

        .review-summary-container {
          padding: 40px;
        }
      }

      @media (max-width: 768px) {
        .customer-reviews-section {
          padding: 0 20px;
        }

        .section-title {
          font-size: 28px;
          margin-bottom: 40px;
        }

        .review-summary-container {
          padding: 30px;
          margin-bottom: 40px;
        }

        .large-rating {
          font-size: 56px;
        }

        .review-submission {
          padding: 5px;
        }

        .review-item {
          padding: 20px;
        }
        .reviews-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .sort-options {
          width: 100%;
        }

        .sort-options select {
          flex: 1;
        }

        .star-selector {
          gap: 8px;
        }

        .star-label-input i {
          font-size: 24px;
        }
      }

      /* ================= ADDITIONAL RESPONSIVE IMPROVEMENTS ================= */
      /* Mobile-first refinements for product page */
      @media (max-width: 900px) {
        .product-details {
          grid-template-columns: 1fr;
          padding: 20px;
          gap: 22px;
        }

        .product-details-image img,
        .product-image img,
        .details-image img {
          height: auto;
          max-height: 480px;
          object-fit: cover;
        }

        /* Make action buttons compact and inline */
        .details-actions,
        .product-details-actions {
          display: flex;
          flex-direction: row;
          gap: 10px;
          justify-content: flex-start;
          align-items: center;
          flex-wrap: nowrap;
        }

        .details-actions a,
        .product-details-actions a {
          padding: 10px 14px;
          font-size: 14px;
          min-width: 0;
          border-radius: 10px;
          flex: 0 1 auto;
        }

        .product-details-info h1,
        .product-details-info h2 {
          font-size: 28px;
        }

        .product-details-price {
          font-size: 20px;
        }

        .product-details-desc,
        .product-description p,
        .review-text {
          font-size: 15px;
          line-height: 1.6;
        }

        /* Related products - 2-column on smaller screens */
        .related-products .products {
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
        }
      }

      @media (max-width: 600px) {
        .product-details {
          padding: 14px;
          gap: 16px;
        }

        .product-details-image img,
        .details-image img {
          height: 320px;
        }

        .product-details-info h1,
        .product-details-info h2 {
          font-size: 22px;
        }

        .product-details-price {
          font-size: 18px;
        }

        .details-actions a,
        .product-details-actions a {
          padding: 8px 10px;
          font-size: 13px;
          border-radius: 8px;
          flex: 1 1 48%;
        }

        .details-actions {
          gap: 8px;
          flex-wrap: wrap;
        }

        .product-description p,
        .product-details-desc {
          font-size: 14px;
        }

        .review-item {
          padding: 16px;
        }

        .submit-btn {
          padding: 12px 20px;
          font-size: 14px;
        }
      }
    </style>
    <hr
      style="
        margin-top: 40px;
        margin-bottom: 40px;
        border: none;
        border-top: 1px solid #757272;
      "
    />
    <!-- ================= FOOTER ================= -->
    <footer class="footer animate-fade-in">
      <div class="footer-container">
        <div class="footer-section animate-fade-in-up stagger-item-1">
          <h4>About LR Fragrances</h4>
          <p>
            Luxury fragrances for the discerning individual. Premium quality,
            authentic products, delivered with care.
          </p>
        </div>
        <div class="footer-section animate-fade-in-up stagger-item-2">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="/shop" class="animate-link">Shop</a></li>
            <li><a href="/about" class="animate-link">About Us</a></li>
            <li><a href="/contact" class="animate-link">Contact</a></li>
            <li><a href="/support" class="animate-link">Support</a></li>
          </ul>
        </div>
        <div class="footer-section animate-fade-in-up stagger-item-3">
          <h4>Policies</h4>
          <ul>
            <li>
              <a href="{{ url_for('privacy_policy') }}" class="animate-link"
                >Privacy Policy</a
              >
            </li>
            <li>
              <a href="{{ url_for('terms') }}" class="animate-link"
                >Terms & Conditons</a
              >
            </li>
            <li>
              <a href="{{ url_for('shipping_policy') }}" class="animate-link"
                >Shipping Info</a
              >
            </li>
          </ul>
        </div>
        <div class="footer-section animate-fade-in-up stagger-item-4">
          <h4>Follow Us</h4>
          <div class="social-icons">
            <a
              href="https://www.facebook.com/share/16mTFkThmz/"
              target="_blank"
              aria-label="Facebook"
              class="animate-social-icon"
              ><i class="fa-brands fa-facebook-f"></i
            ></a>
            <a
              href="https://www.instagram.com/lrperfumes5"
              target="_blank"
              aria-label="Instagram"
              class="animate-social-icon"
              ><i class="fa-brands fa-instagram"></i
            ></a>
            <a
              href="https://www.tiktok.com/@lrperfumes5"
              target="_blank"
              aria-label="TikTok"
              class="animate-social-icon"
              ><i class="fa-brands fa-tiktok"></i
            ></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 LR Fragrances. All Rights Reserved.</p>
      </div>
    </footer>
    <!-- WHATSAPP BUTTON -->
    <a
      href="https://wa.me/message/S2X7CX7MZK75F1"
      target="_blank"
      class="whatsapp-btn animate-float"
    >
      <i class="fa-brands fa-whatsapp"></i>
    </a>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
      <i class="fas fa-moon"></i>
    </button>
    <!-- JS (FIXED) -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const hamburger = document.getElementById("hamburger");
        const nav = document.getElementById("nav-menu");
        const overlay = document.getElementById("navOverlay");

        hamburger.addEventListener("click", () => {
          hamburger.classList.toggle("active");
          nav.classList.toggle("active");
          overlay.classList.toggle("active");
        });

        overlay.addEventListener("click", closeMenu);

        document.querySelectorAll("#nav-menu a").forEach((link) => {
          link.addEventListener("click", closeMenu);
        });

        function closeMenu() {
          hamburger.classList.remove("active");
          nav.classList.remove("active");
          overlay.classList.remove("active");
        }
      });
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": "{{ product.name }}",
        "image": [
          "{{ url_for('static', filename='images/products/' + product.image, _external=True) }}"
        ],
        "description": "{{ product.description|striptags }}",
        "sku": "{{ product.id }}",
        "brand": {
          "@type": "Brand",
          "name": "LR Fragrances"
        },
        "offers": {
          "@type": "Offer",
          "url": "{{ request.url }}",
          "priceCurrency": "PKR",
          "price": "{{ product.price }}",
          "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "{{ avg_rating if avg_rating else 5 }}",
          "reviewCount": "{{ reviews|length }}"
        },
        "review": [
          {% for review in reviews %}
          {
            "@type": "Review",
            "author": {
              "@type": "Person",
              "name": "{{ review.username }}"
            },
            "datePublished": "{{ review.created_at }}",
            "reviewBody": "{{ review.comment|striptags }}",
            "reviewRating": {
              "@type": "Rating",
              "ratingValue": "{{ review.rating }}",
              "bestRating": "5",
              "worstRating": "1"
            }
          }{% if not loop.last %},{% endif %}
          {% endfor %}
        ]
      }
    </script>

    <!-- ================= REVIEW SYSTEM JAVASCRIPT ================= -->
    <script>
      // Character counter for review textarea
      const reviewText = document.getElementById("review-text");
      const charUsed = document.getElementById("char-used");
      if (reviewText) {
        reviewText.addEventListener("input", () => {
          charUsed.textContent = reviewText.value.length;
        });
      }

      // Star rating selector
      const starLabels = document.querySelectorAll(".star-label-input");
      const ratingText = document.getElementById("rating-text");
      const ratingSelect = document.getElementById("rating-select");

      const ratingTexts = {
        1: "Poor - Not recommended",
        2: "Fair - Could be better",
        3: "Good - Meets expectations",
        4: "Very Good - Highly satisfied",
        5: "Excellent - Highly recommended",
      };

      starLabels.forEach((label) => {
        label.addEventListener("click", () => {
          const value = label.querySelector("input").value;
          ratingSelect.value = value;
          ratingText.textContent = ratingTexts[value] || "Select a rating";
          ratingText.style.color = "#d4af37";
        });
      });

      // Sort reviews
      function sortReviews(sortBy) {
        const reviewsGrid = document.getElementById("reviewsGrid");
        const reviews = Array.from(
          reviewsGrid.querySelectorAll(".review-item"),
        );

        reviews.sort((a, b) => {
          const ratingA = parseInt(a.getAttribute("data-rating"));
          const ratingB = parseInt(b.getAttribute("data-rating"));

          if (sortBy === "highest") {
            return ratingB - ratingA;
          } else if (sortBy === "lowest") {
            return ratingA - ratingB;
          }
          // Default: recent (order from HTML)
          return 0;
        });

        reviewsGrid.innerHTML = "";
        reviews.forEach((review) => {
          reviewsGrid.appendChild(review);
        });
      }

      // Mark review as helpful
      function markHelpful(btn) {
        btn.style.color = "#4caf50";
        btn.style.borderColor = "#4caf50";
        btn.style.background = "rgba(76, 175, 80, 0.1)";
        btn.disabled = true;
        const sibling = btn.nextElementSibling;
        if (sibling) {
          sibling.style.opacity = "0.5";
          sibling.disabled = true;
        }
      }

      // Mark review as unhelpful
      function markUnhelpful(btn) {
        btn.style.color = "#ff6b6b";
        btn.style.borderColor = "#ff6b6b";
        btn.style.background = "rgba(255, 107, 107, 0.1)";
        btn.disabled = true;
        const sibling = btn.previousElementSibling;
        if (sibling) {
          sibling.style.opacity = "0.5";
          sibling.disabled = true;
        }
      }

      // Form validation
      const reviewForm = document.querySelector(".review-form");
      if (reviewForm) {
        reviewForm.addEventListener("submit", (e) => {
          if (!ratingSelect.value) {
            e.preventDefault();
            alert("Please select a rating before submitting your review.");
            return;
          }
          if (!reviewText || reviewText.value.trim().length < 10) {
            e.preventDefault();
            alert("Please write at least 10 characters in your review.");
            return;
          }
        });
      }

      // Apply bar fill widths from data attributes
      document.querySelectorAll(".bar-fill").forEach((bar) => {
        const width = bar.getAttribute("data-width");
        if (width) {
          bar.style.width = width + "%";
        }
      });
    </script>

    <!-- THEME TOGGLE BUTTON -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <i class="fas fa-moon"></i>
    </button>

    <!-- THEME TOGGLE SCRIPT -->
    <script>
        // Initialize theme from localStorage
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('theme') || 'dark-theme';
        
        document.body.classList.add(savedTheme);
        updateThemeIcon();

        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            const isDark = document.body.classList.contains('dark-theme');
            
            if (isDark) {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                localStorage.setItem('theme', 'light-theme');
            } else {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark-theme');
            }
            updateThemeIcon();
        });

        function updateThemeIcon() {
            const isDark = document.body.classList.contains('dark-theme');
            themeToggle.innerHTML = isDark ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }
    </script>
  </body>
</html>
